<div class="content-section">
    <div class="intro-box" style="margin-bottom: 40px;">
        <h2 style="font-size: 2.3rem; margin-bottom: 10px; color: #000;">PDF í•©ì¹˜ê¸° (Web Version)</h2>
        <p style="font-size: 1.1rem; color: #666;">ë³„ë„ì˜ ì„¤ì¹˜ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì—¬ëŸ¬ PDFë¥¼ í•˜ë‚˜ë¡œ í•©ì¹˜ì„¸ìš”.</p>
    </div>

    <div class="web-tool-container"
        style="background: #fff; border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee;">
        <div class="upload-area" id="drop-zone"
            style="border: 2px dashed #ddd; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 30px;">
            <div style="font-size: 3.5rem; margin-bottom: 15px;">ğŸ“‚</div>
            <h4 style="margin: 0 0 10px 0; font-size: 1.3rem;">PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h4>
            <p style="margin: 0; color: #888;">ì—¬ëŸ¬ ê°œì˜ PDF íŒŒì¼ì„ í•œêº¼ë²ˆì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <input type="file" id="pdf-input" multiple accept="application/pdf" style="display: none;">
        </div>

        <div id="file-list-container" style="display: none;">
            <h4
                style="margin-bottom: 15px; font-size: 1.1rem; color: #333; display: flex; align-items: center; gap: 8px;">
                <span>ğŸ“‹</span> ì„ íƒëœ íŒŒì¼ ëª©ë¡ (ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤)
            </h4>
            <ul id="pdf-file-list"
                style="list-style: none; padding: 0; margin: 0 0 30px 0; display: flex; flex-direction: column; gap: 10px;">
                <!-- íŒŒì¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </ul>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="merge-btn"
                    style="padding: 15px 40px; background: #d32f2f; color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(211, 47, 47, 0.2);">
                    PDF í•©ì¹˜ê¸° ë° ë‹¤ìš´ë¡œë“œ
                </button>
                <button id="reset-btn"
                    style="padding: 15px 30px; background: #f5f5f5; color: #666; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    ë‹¤ì‹œ ì‹œì‘
                </button>
            </div>
        </div>
    </div>

    <div class="info-note"
        style="background: #fff3e0; padding: 20px; border-radius: 12px; border-left: 4px solid #ff9800; margin-top: 40px;">
        <h5 style="margin: 0 0 10px 0; color: #e65100; font-size: 1rem;">ğŸ›¡ï¸ ê°œì¸ì •ë³´ ë³´í˜¸ ì•ˆë‚´</h5>
        <p style="margin: 0; font-size: 0.95rem; color: #555; line-height: 1.6;">
            ì„ íƒí•˜ì‹  íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šê³  <strong>ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì € ë‚´ì—ì„œ ì§ì ‘ ì²˜ë¦¬</strong>ë©ë‹ˆë‹¤.
            ë¬¸ì„œì˜ ë‚´ìš©ì€ ì™¸ë¶€ë¡œ ìœ ì¶œë˜ì§€ ì•Šìœ¼ë‹ˆ ì•ˆì‹¬í•˜ê³  ì‚¬ìš©í•˜ì„¸ìš”.
        </p>
    </div>

    <!-- License and Reference -->
    <div class="reference-section"
        style="margin-top: 40px; padding: 20px; border-top: 1px solid #eee; color: #888; font-size: 0.85rem;">
        <p style="margin: 0 0 10px 0;"><strong>ì‚¬ìš©ëœ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬:</strong></p>
        <ul style="margin: 0 0 15px 0; padding-left: 20px; line-height: 1.6;">
            <li>pdf-lib (MIT License): <a href="https://github.com/Hopding/pdf-lib" target="_blank"
                    style="color: #666;">https://github.com/Hopding/pdf-lib</a></li>
            <li>pdf.js (Apache 2.0 License): <a href="https://github.com/mozilla/pdf.js" target="_blank"
                    style="color: #666;">https://github.com/mozilla/pdf.js</a></li>
        </ul>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script>
    (function () {
        const dropZone = document.getElementById('drop-zone');
        const pdfInput = document.getElementById('pdf-input');
        const fileListContainer = document.getElementById('file-list-container');
        const pdfFileList = document.getElementById('pdf-file-list');
        const mergeBtn = document.getElementById('merge-btn');
        const resetBtn = document.getElementById('reset-btn');

        let selectedFiles = [];

        // ë“œë¡­ì¡´ í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
        dropZone.addEventListener('click', () => pdfInput.click());

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        pdfInput.addEventListener('change', (e) => handleFiles(e.target.files));

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#d32f2f';
            dropZone.style.background = '#fff8f8';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#ddd';
            dropZone.style.background = 'transparent';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ddd';
            dropZone.style.background = 'transparent';
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            const newFiles = Array.from(files).filter(file => file.type === 'application/pdf');
            if (newFiles.length === 0) return;

            selectedFiles = [...selectedFiles, ...newFiles];
            renderFileList();
        }

        function renderFileList() {
            if (selectedFiles.length > 0) {
                fileListContainer.style.display = 'block';
                dropZone.style.padding = '20px';
                dropZone.querySelector('h4').textContent = 'íŒŒì¼ ì¶”ê°€í•˜ê¸°';
            }

            pdfFileList.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.style.cssText = 'display: flex; align-items: center; gap: 15px; padding: 12px 20px; background: #f8f9fa; border: 1px solid #eee; border-radius: 8px; cursor: move;';
                li.draggable = true;
                li.dataset.index = index;

                li.innerHTML = `
                <span style="color: #adb5bd;">â˜°</span>
                <span style="flex: 1; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${file.name}</span>
                <span style="font-size: 0.85rem; color: #888;">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                <button class="remove-btn" data-index="${index}" style="background: none; border: none; color: #ff5252; cursor: pointer; font-size: 1.2rem; padding: 0 5px;">âœ•</button>
            `;

                // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìˆœì„œ ë³€ê²½ ë¡œì§
                li.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', index);
                    li.style.opacity = '0.5';
                });

                li.addEventListener('dragend', () => {
                    li.style.opacity = '1';
                });

                pdfFileList.appendChild(li);
            });

            // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const idx = parseInt(e.target.dataset.index);
                    selectedFiles.splice(idx, 1);
                    renderFileList();
                    if (selectedFiles.length === 0) {
                        fileListContainer.style.display = 'none';
                        dropZone.style.padding = '40px';
                        dropZone.querySelector('h4').textContent = 'PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”';
                    }
                });
            });
        }

        // ë¦¬ìŠ¤íŠ¸ ë‚´ ë“œë¡­ ì²˜ë¦¬
        pdfFileList.addEventListener('dragover', (e) => {
            e.preventDefault();
            const draggingItem = pdfFileList.querySelector('[style*="opacity: 0.5"]');
            const siblings = [...pdfFileList.querySelectorAll('li:not([style*="opacity: 0.5"])')];
            const nextSibling = siblings.find(sibling => {
                return e.clientY <= sibling.getBoundingClientRect().top + sibling.getBoundingClientRect().height / 2;
            });
            pdfFileList.insertBefore(draggingItem, nextSibling);
        });

        pdfFileList.addEventListener('drop', (e) => {
            e.preventDefault();
            const newOrder = [...pdfFileList.querySelectorAll('li')].map(li => parseInt(li.dataset.index));
            selectedFiles = newOrder.map(idx => selectedFiles[idx]);
            renderFileList();
        });

        // ì´ˆê¸°í™”
        resetBtn.addEventListener('click', () => {
            selectedFiles = [];
            pdfFileList.innerHTML = '';
            fileListContainer.style.display = 'none';
            dropZone.style.padding = '40px';
            dropZone.querySelector('h4').textContent = 'PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”';
            pdfInput.value = '';
        });

        // ë³‘í•© ì‹¤í–‰
        mergeBtn.addEventListener('click', async () => {
            if (selectedFiles.length < 2) {
                alert('ìµœì†Œ 2ê°œ ì´ìƒì˜ PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            mergeBtn.disabled = true;
            mergeBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
            mergeBtn.style.opacity = '0.7';

            try {
                const mergedPdf = await PDFLib.PDFDocument.create();

                for (const file of selectedFiles) {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                    const copiedPages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    copiedPages.forEach((page) => mergedPdf.addPage(page));
                }

                const pdfBytes = await mergedPdf.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `merged_${new Date().getTime()}.pdf`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('PDF í•©ì¹˜ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('Merge error:', error);
                alert('PDF ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                mergeBtn.disabled = false;
                mergeBtn.textContent = 'PDF í•©ì¹˜ê¸° ë° ë‹¤ìš´ë¡œë“œ';
                mergeBtn.style.opacity = '1';
            }
        });
    })();
</script>