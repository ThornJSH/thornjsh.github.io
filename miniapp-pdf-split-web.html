<div class="content-section">
    <div class="intro-box" style="margin-bottom: 40px;">
        <h2 style="font-size: 2.3rem; margin-bottom: 10px; color: #000;">PDF ë‚˜ëˆ„ê¸° (Web Version)</h2>
        <p style="font-size: 1.1rem; color: #666;">PDF íŒŒì¼ì„ ì›í•˜ëŠ” í˜ì´ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‘ ê°œì˜ íŒŒì¼ë¡œ ë¶„í• í•˜ì„¸ìš”.</p>
    </div>

    <div class="web-tool-container"
        style="background: #fff; border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee;">
        <div class="upload-area" id="split-drop-zone"
            style="border: 2px dashed #ddd; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 30px;">
            <div style="font-size: 3.5rem; margin-bottom: 15px;">âœ‚ï¸</div>
            <h4 style="margin: 0 0 10px 0; font-size: 1.3rem;">PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h4>
            <p style="margin: 0; color: #888;">í•˜ë‚˜ì˜ PDF íŒŒì¼ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <input type="file" id="split-pdf-input" accept="application/pdf" style="display: none;">
        </div>

        <div id="split-settings-container" style="display: none;">
            <div
                style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 30px; border: 1px solid #eee;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                    <div style="font-size: 2rem;">ğŸ“„</div>
                    <div>
                        <h4 id="target-file-name" style="margin: 0; font-size: 1.1rem; color: #333;">íŒŒì¼ëª….pdf</h4>
                        <p id="target-file-info" style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">ì´ 0í˜ì´ì§€ /
                            0.00 MB</p>
                    </div>
                </div>

                <!-- Mode Selector -->
                <div style="display: flex; gap: 10px; margin-bottom: 25px;">
                    <button id="mode-split" class="mode-btn active"
                        style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: #fff; font-weight: 600; cursor: pointer;">2ê°œë¡œ
                        ë‚˜ëˆ„ê¸°</button>
                    <button id="mode-extract" class="mode-btn"
                        style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: #fff; font-weight: 600; cursor: pointer;">ë²”ìœ„
                        ì¶”ì¶œí•˜ê¸°</button>
                </div>

                <div id="split-input-group" style="border-top: 1px solid #eee; padding-top: 20px;">
                    <label for="split-point"
                        style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">ë¶„í•  ì§€ì  í˜ì´ì§€ ë²ˆí˜¸</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="number" id="split-point" min="1" value="1"
                            style="width: 100px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                        <span style="color: #666; font-size: 0.95rem;">í˜ì´ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.</span>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #888;">
                        * ì˜ˆ: 3ì„ ì…ë ¥í•˜ë©´ 1~3í˜ì´ì§€(íŒŒì¼ 1)ì™€ 4í˜ì´ì§€~ë(íŒŒì¼ 2)ìœ¼ë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤.
                    </p>
                </div>

                <div id="extract-input-group" style="border-top: 1px solid #eee; padding-top: 20px; display: none;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">ì¶”ì¶œí•  í˜ì´ì§€
                        ë²”ìœ„</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="extract-start" min="1" value="1"
                            style="width: 80px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                        <span>~</span>
                        <input type="number" id="extract-end" min="1" value="1"
                            style="width: 80px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                        <span style="color: #666; font-size: 0.95rem;">ì„¹ì…˜ë§Œ ë”°ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</span>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #888;">
                        * ì„ íƒí•œ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤ë§Œ í¬í•¨ëœ í•˜ë‚˜ì˜ ìƒˆë¡œìš´ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="split-run-btn"
                    style="padding: 15px 40px; background: #2e7d32; color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);">
                    ì‹¤í–‰ ë° ë‹¤ìš´ë¡œë“œ
                </button>
                <button id="split-reset-btn"
                    style="padding: 15px 30px; background: #f5f5f5; color: #666; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    ë‹¤ë¥¸ íŒŒì¼ ì„ íƒ
                </button>
            </div>
        </div>
    </div>

    <style>
        .mode-btn.active {
            border-color: #2e7d32 !important;
            color: #2e7d32 !important;
            background: #f1f8e9 !important;
        }
    </style>

    <div class="info-note"
        style="background: #e1f5fe; padding: 20px; border-radius: 12px; border-left: 4px solid #03a9f4; margin-top: 40px;">
        <h5 style="margin: 0 0 10px 0; color: #01579b; font-size: 1rem;">ğŸ’¡ í™œìš© íŒ</h5>
        <p style="margin: 0; font-size: 0.95rem; color: #555; line-height: 1.6;">
            <strong>ë‚˜ëˆ„ê¸°:</strong> ê¸´ ë¬¸ì„œë¥¼ ë‘ ë¶€ë¶„ìœ¼ë¡œ ë¶„ë¦¬í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.<br>
            <strong>ì¶”ì¶œí•˜ê¸°:</strong> ë¬¸ì„œ ì¤‘ê°„ì˜ íŠ¹ì • ë³´ê³ ì„œë‚˜ ì„œì‹ ë¶€ë¶„ë§Œ ë”°ë¡œ ë½‘ì•„ë‚¼ ë•Œ ì‚¬ìš©í•˜ì„¸ìš”.
        </p>
    </div>

    <!-- License and Reference -->
    <div class="reference-section"
        style="margin-top: 40px; padding: 20px; border-top: 1px solid #eee; color: #888; font-size: 0.85rem;">
        <p style="margin: 0 0 10px 0;"><strong>ì‚¬ìš©ëœ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬:</strong></p>
        <ul style="margin: 0 0 15px 0; padding-left: 20px; line-height: 1.6;">
            <li>pdf-lib (MIT License): <a href="https://github.com/Hopding/pdf-lib" target="_blank"
                    style="color: #666;">https://github.com/Hopding/pdf-lib</a></li>
            <li>pdf.js (Apache 2.0 License): <a href="https://github.com/mozilla/pdf.js" target="_blank"
                    style="color: #666;">https://github.com/mozilla/pdf.js</a></li>
        </ul>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script>
    (function () {
        const dropZone = document.getElementById('split-drop-zone');
        const pdfInput = document.getElementById('split-pdf-input');
        const settingsContainer = document.getElementById('split-settings-container');
        const fileNameDisplay = document.getElementById('target-file-name');
        const fileInfoDisplay = document.getElementById('target-file-info');
        const splitPointInput = document.getElementById('split-point');
        const extractStartInput = document.getElementById('extract-start');
        const extractEndInput = document.getElementById('extract-end');
        const runBtn = document.getElementById('split-run-btn');
        const resetBtn = document.getElementById('split-reset-btn');
        const modeSplitBtn = document.getElementById('mode-split');
        const modeExtractBtn = document.getElementById('mode-extract');
        const splitInputGroup = document.getElementById('split-input-group');
        const extractInputGroup = document.getElementById('extract-input-group');

        let targetFile = null;
        let totalPages = 0;
        let currentMode = 'split'; // 'split' or 'extract'

        // ëª¨ë“œ ì „í™˜
        modeSplitBtn.addEventListener('click', () => {
            currentMode = 'split';
            modeSplitBtn.classList.add('active');
            modeExtractBtn.classList.remove('active');
            splitInputGroup.style.display = 'block';
            extractInputGroup.style.display = 'none';
        });

        modeExtractBtn.addEventListener('click', () => {
            currentMode = 'extract';
            modeExtractBtn.classList.add('active');
            modeSplitBtn.classList.remove('active');
            splitInputGroup.style.display = 'none';
            extractInputGroup.style.display = 'block';
        });

        dropZone.addEventListener('click', () => pdfInput.click());
        pdfInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#2e7d32';
            dropZone.style.background = '#f1f8e9';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#ddd';
            dropZone.style.background = 'transparent';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ddd';
            dropZone.style.background = 'transparent';
            handleFile(e.dataTransfer.files[0]);
        });

        async function handleFile(file) {
            if (!file || file.type !== 'application/pdf') {
                alert('PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            targetFile = file;

            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                totalPages = pdfDoc.getPageCount();

                fileNameDisplay.textContent = file.name;
                fileInfoDisplay.textContent = `ì´ ${totalPages}í˜ì´ì§€ / ${(file.size / 1024 / 1024).toFixed(2)} MB`;

                splitPointInput.max = totalPages - 1;
                splitPointInput.value = Math.floor(totalPages / 2) || 1;

                extractStartInput.max = totalPages;
                extractEndInput.max = totalPages;
                extractStartInput.value = 1;
                extractEndInput.value = totalPages;

                settingsContainer.style.display = 'block';
                dropZone.style.display = 'none';
            } catch (error) {
                console.error('File load error:', error);
                alert('PDF íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        resetBtn.addEventListener('click', () => {
            targetFile = null;
            settingsContainer.style.display = 'none';
            dropZone.style.display = 'block';
            pdfInput.value = '';
        });

        runBtn.addEventListener('click', async () => {
            runBtn.disabled = true;
            runBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
            runBtn.style.opacity = '0.7';

            try {
                const arrayBuffer = await targetFile.arrayBuffer();
                const srcDoc = await PDFLib.PDFDocument.load(arrayBuffer);

                if (currentMode === 'split') {
                    const splitVal = parseInt(splitPointInput.value);
                    if (isNaN(splitVal) || splitVal < 1 || splitVal >= totalPages) {
                        throw new Error(`1ë¶€í„° ${totalPages - 1} ì‚¬ì´ì˜ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                    }

                    // íŒŒì¼ 1 ìƒì„± (1 ~ splitVal)
                    const doc1 = await PDFLib.PDFDocument.create();
                    const pages1 = await doc1.copyPages(srcDoc, Array.from({ length: splitVal }, (_, i) => i));
                    pages1.forEach(p => doc1.addPage(p));
                    const bytes1 = await doc1.save();

                    // íŒŒì¼ 2 ìƒì„± (splitVal + 1 ~ ë)
                    const doc2 = await PDFLib.PDFDocument.create();
                    const pages2 = await doc2.copyPages(srcDoc, Array.from({ length: totalPages - splitVal }, (_, i) => i + splitVal));
                    pages2.forEach(p => doc2.addPage(p));
                    const bytes2 = await doc2.save();

                    download(bytes1, `${targetFile.name.replace('.pdf', '')}_part1.pdf`);
                    setTimeout(() => download(bytes2, `${targetFile.name.replace('.pdf', '')}_part2.pdf`), 500);
                } else {
                    const start = parseInt(extractStartInput.value);
                    const end = parseInt(extractEndInput.value);

                    if (isNaN(start) || isNaN(end) || start < 1 || end > totalPages || start > end) {
                        throw new Error(`ìœ íš¨í•œ ë²”ìœ„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (1 ~ ${totalPages})`);
                    }

                    const extractDoc = await PDFLib.PDFDocument.create();
                    const rangePages = await extractDoc.copyPages(srcDoc, Array.from({ length: end - start + 1 }, (_, i) => i + start - 1));
                    rangePages.forEach(p => extractDoc.addPage(p));
                    const extractBytes = await extractDoc.save();

                    download(extractBytes, `${targetFile.name.replace('.pdf', '')}_extracted_${start}-${end}.pdf`);
                }

                alert('ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');

            } catch (error) {
                console.error('Process error:', error);
                alert(error.message || 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'ì‹¤í–‰ ë° ë‹¤ìš´ë¡œë“œ';
                runBtn.style.opacity = '1';
            }
        });

        function download(bytes, name) {
            const blob = new Blob([bytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    })();
</script>