<div class="content-section">
    <div class="intro-box" style="margin-bottom: 40px;">
        <h2 style="font-size: 2.3rem; margin-bottom: 10px; color: #000;">PDF ë‚˜ëˆ„ê¸° (Web Version)</h2>
        <p style="font-size: 1.1rem; color: #666;">PDF íŒŒì¼ì„ ì›í•˜ëŠ” í˜ì´ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‘ ê°œì˜ íŒŒì¼ë¡œ ë¶„í• í•˜ì„¸ìš”.</p>
    </div>

    <div class="web-tool-container"
        style="background: #fff; border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee;">
        <div class="upload-area" id="split-drop-zone"
            style="border: 2px dashed #ddd; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 30px;">
            <div style="font-size: 3.5rem; margin-bottom: 15px;">âœ‚ï¸</div>
            <h4 style="margin: 0 0 10px 0; font-size: 1.3rem;">ë‚˜ëˆŒ PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h4>
            <p style="margin: 0; color: #888;">í•˜ë‚˜ì˜ PDF íŒŒì¼ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <input type="file" id="split-pdf-input" accept="application/pdf" style="display: none;">
        </div>

        <div id="split-settings-container" style="display: none;">
            <div
                style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 30px; border: 1px solid #eee;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div style="font-size: 2rem;">ğŸ“„</div>
                    <div>
                        <h4 id="target-file-name" style="margin: 0; font-size: 1.1rem; color: #333;">íŒŒì¼ëª….pdf</h4>
                        <p id="target-file-info" style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">ì´ 0í˜ì´ì§€ /
                            0.00 MB</p>
                    </div>
                </div>

                <div style="border-top: 1px solid #eee; padding-top: 20px; margin-top: 20px;">
                    <label for="split-point"
                        style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">ë¶„í•  ì§€ì  í˜ì´ì§€ ë²ˆí˜¸</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="number" id="split-point" min="1" value="1"
                            style="width: 100px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                        <span style="color: #666; font-size: 0.95rem;">í˜ì´ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.</span>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #888;">
                        * ì˜ˆ: 3ì„ ì…ë ¥í•˜ë©´ 1~3í˜ì´ì§€(íŒŒì¼ 1)ì™€ 4í˜ì´ì§€~ë(íŒŒì¼ 2)ìœ¼ë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="split-run-btn"
                    style="padding: 15px 40px; background: #2e7d32; color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);">
                    PDF ë‚˜ëˆ„ê¸° ë° ë‹¤ìš´ë¡œë“œ
                </button>
                <button id="split-reset-btn"
                    style="padding: 15px 30px; background: #f5f5f5; color: #666; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    ë‹¤ë¥¸ íŒŒì¼ ì„ íƒ
                </button>
            </div>
        </div>
    </div>

    <div class="info-note"
        style="background: #e1f5fe; padding: 20px; border-radius: 12px; border-left: 4px solid #03a9f4; margin-top: 40px;">
        <h5 style="margin: 0 0 10px 0; color: #01579b; font-size: 1rem;">ğŸ’¡ í™œìš© íŒ</h5>
        <p style="margin: 0; font-size: 0.95rem; color: #555; line-height: 1.6;">
            ë‚˜ëˆ„ê¸° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ëŒ€ìš©ëŸ‰ PDFì—ì„œ í•„ìš”í•œ ì„¹ì…˜ë§Œ ë¶„ë¦¬í•˜ê±°ë‚˜ ê³µë¬¸ì„œì˜ ë¶™ì„ ì„œë¥˜ë§Œ ë”°ë¡œ ì¶”ì¶œí•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.
            ëª¨ë“  ê³¼ì •ì€ <strong>ë³´ì•ˆì„ ìœ„í•´ ë‚´ë¶€ ì‹œìŠ¤í…œ</strong>ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
        </p>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script>
    (function () {
        const dropZone = document.getElementById('split-drop-zone');
        const pdfInput = document.getElementById('split-pdf-input');
        const settingsContainer = document.getElementById('split-settings-container');
        const fileNameDisplay = document.getElementById('target-file-name');
        const fileInfoDisplay = document.getElementById('target-file-info');
        const splitPointInput = document.getElementById('split-point');
        const runBtn = document.getElementById('split-run-btn');
        const resetBtn = document.getElementById('split-reset-btn');

        let targetFile = null;
        let totalPages = 0;

        dropZone.addEventListener('click', () => pdfInput.click());
        pdfInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#2e7d32';
            dropZone.style.background = '#f1f8e9';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#ddd';
            dropZone.style.background = 'transparent';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ddd';
            dropZone.style.background = 'transparent';
            handleFile(e.dataTransfer.files[0]);
        });

        async function handleFile(file) {
            if (!file || file.type !== 'application/pdf') {
                alert('PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            targetFile = file;

            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                totalPages = pdfDoc.getPageCount();

                fileNameDisplay.textContent = file.name;
                fileInfoDisplay.textContent = `ì´ ${totalPages}í˜ì´ì§€ / ${(file.size / 1024 / 1024).toFixed(2)} MB`;

                splitPointInput.max = totalPages - 1;
                splitPointInput.value = Math.floor(totalPages / 2) || 1;

                settingsContainer.style.display = 'block';
                dropZone.style.display = 'none';
            } catch (error) {
                console.error('File load error:', error);
                alert('PDF íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        resetBtn.addEventListener('click', () => {
            targetFile = null;
            settingsContainer.style.display = 'none';
            dropZone.style.display = 'block';
            pdfInput.value = '';
        });

        runBtn.addEventListener('click', async () => {
            const splitVal = parseInt(splitPointInput.value);

            if (isNaN(splitVal) || splitVal < 1 || splitVal >= totalPages) {
                alert(`1ë¶€í„° ${totalPages - 1} ì‚¬ì´ì˜ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                return;
            }

            runBtn.disabled = true;
            runBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
            runBtn.style.opacity = '0.7';

            try {
                const arrayBuffer = await targetFile.arrayBuffer();
                const srcDoc = await PDFLib.PDFDocument.load(arrayBuffer);

                // íŒŒì¼ 1 ìƒì„± (1 ~ splitVal)
                const doc1 = await PDFLib.PDFDocument.create();
                const pages1 = await doc1.copyPages(srcDoc, Array.from({ length: splitVal }, (_, i) => i));
                pages1.forEach(p => doc1.addPage(p));
                const bytes1 = await doc1.save();

                // íŒŒì¼ 2 ìƒì„± (splitVal + 1 ~ ë)
                const doc2 = await PDFLib.PDFDocument.create();
                const pages2 = await doc2.copyPages(srcDoc, Array.from({ length: totalPages - splitVal }, (_, i) => i + splitVal));
                pages2.forEach(p => doc2.addPage(p));
                const bytes2 = await doc2.save();

                // ìˆœì°¨ì  ë‹¤ìš´ë¡œë“œ
                download(bytes1, `${targetFile.name.replace('.pdf', '')}_part1.pdf`);

                // ì•½ê°„ì˜ ì§€ì—° í›„ ë‘ ë²ˆì§¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ë¸Œë¼ìš°ì € ì •ì±… ëŒ€ì‘)
                setTimeout(() => {
                    download(bytes2, `${targetFile.name.replace('.pdf', '')}_part2.pdf`);
                    alert('íŒŒì¼ ë¶„í• ì´ ì™„ë£Œë˜ì–´ 2ê°œì˜ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.');
                }, 500);

            } catch (error) {
                console.error('Split error:', error);
                alert('PDF ë¶„í•  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'PDF ë‚˜ëˆ„ê¸° ë° ë‹¤ìš´ë¡œë“œ';
                runBtn.style.opacity = '1';
            }
        });

        function download(bytes, name) {
            const blob = new Blob([bytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    })();
</script>